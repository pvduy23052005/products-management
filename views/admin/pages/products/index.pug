extends ../../layouts/default.pug
include ../../mixins/select-tree.pug
include ../../mixins/alert.pug
include ../../mixins/moment.pug

block main 
   if(role.permissions.includes("products_view"))
      +alert-success(5000)
      +alert-error(5000)
      h1(class = "title") #{pageTitle}

      .card.mb-3
         .card-header 
            .row 
               .col-2
                  a(href="/admin/products" class = "btn") Bộ lọc và tìm kiếm
               .col-10
                  .sort-head
                     button(
                        sort-clear
                        class = "clear-button"
                     ) Xóa thay đổi
         .card-body 
            .row
               .col-6
                  each item in listbutton 
                     button(
                        class = `btn btn-sm ml-1 btn-outline-success ${item.class}`
                        button-status = item.status
                     ) #{item.name}
               .col-6
                  //- tinh nang tinh kiem . 
                  form(id ="form-search")
                     .input-group
                        input(
                           type="text"
                           placeholder = "Nhập từ khóa"
                           class = "form-control"
                           name ="keyword"
                           value = keyword
                        )
                        .input-group-append
                           button(
                              type ="submit" 
                              class ="btn btn-success"
                              ) Tìm kiếm  
                  
            .row
               .col-4
                  .sort
                     select(
                        class="form-control"
                        name ="sort" 
                        sort-select
                        style = "text-align : center"
                     ) 
                        option(value ="position-desc") Vi trí giảm dần 
                        option(value ="position-asc") Vi trí tăng dần 
                        option(value ="gia-desc") Giá giảm dần  
                        option(value ="gia-asc") Giá tăng dần
                        option(value ="TenSanPham-asc") Tiêu đề A-Z 
                        option(value ="TenSanPham-desc") Tiêu đề Z-A
               .col-6
                  select(
                     name="supplier"
                     supplier-select 
                     class = "form-control"
                     ) 
                        option(value= "") --Nhà cung cấp-- 
                        each item , index in supplier 
                           option( value = item.value) #{item.title} 
                           
      .card.mb-3
         .card-header
            .card-body
               .row
                  .col-8
                     //- tinh nang chinh sua status product
                     form(
                        action=`products/change-multi?_method=PATCH`
                        method = "POST"
                        form-change-multi 
                     )
                        input(
                           type="type"
                           value=""
                           name = "ids"
                           class = "d-none"
                        )
                        select(name="type" class = "select-inProducts") ; 
                           option(value="active") Hoạt động  
                           option(value ="inactive") Dừng hoạt động
                           option(value = "delete-all") Xóa tất cả
                           option(value = "change-position") Thay đổi vị trí
                        button(
                           type ="submit" 
                           class = "btn btn-primary"
                           ) Áp dụng
                  .col-2
                     .product-create
                        if(role.permissions.includes("products_create"))
                           a(
                              href="/admin/products/create"
                              class = "btn btn-outline-success"
                           ) + THêm mới
               .row
                  table(class = "table.table-hover.table-sm" checkbox-multi)
                     thead   
                        tr  
                           th 
                              input(type ="checkbox" , name = "checkAll")
                           th STT 
                           th Hình ảnh
                           th Tiêu đề  
                           th Giá
                           th Số lượng 
                           th Trạng thái  
                           th Người tạo
                           th Hành động
                     tbody
                        each item,index  in product 
                           tr
                              td
                                 input(
                                    type="checkbox"
                                    name ="id"
                                    value = item._id 
                                 )
                              td #{index + 1}
                              td    
                                 a(
                                 href=`/admin/products/detail/${item._id}`
                                    )
                                    img(src=item.hinhAnh, width = "100px" alt="")
                              td #{item.TenSanPham}
                              td #{item.gia}$
                              //- td
                              //-    input(
                              //-       class = "d-none"
                              //-       type = "number"
                              //-       value = item.position 
                              //-       style = "width : 50px "
                              //-       min = "1"
                              //-       name = "position"
                              //-    )
                              td #{item.SoLuong}
                              td 
                                 if(role.permissions.includes("products_edit"))
                                    if(  item.status === "active")
                                       button(
                                          href = "javascript:;"
                                          data-status = item.status
                                          data-id = item._id 
                                          class = "badge badge-success btn btn-success"
                                          button-change-status  
                                       ) Hoạt động
                                    else 
                                       button(
                                          href = "javascript:;"
                                          class = "badge badge-danger btn btn-danger "
                                          data-status = item.status
                                          data-id = item._id 
                                          button-change-status 
                                       ) Dừng hoạt động  
                                 else 
                                    if(  item.status === "active")
                                       button(
                                          class = "badge badge-success btn btn-success" 
                                       ) Hoạt động
                                    else 
                                       button(
                                          class = "badge badge-danger btn btn-danger "
                                       ) Dừng hoạt động
                              td 
                                 p #{item.accountFullName}
                                 p 
                                    +formatDateTime(item.createBy.createAt)
                              td 
                                 if(role.permissions.includes("products_edit"))
                                    a(
                                       href = `/admin/products/edit/${item._id}`
                                       data-id = item._id 
                                       class = "btn btn-warning btn-sm"
                                    ) Sửa
                                 if(role.permissions.includes("products_delete"))
                                    button(
                                       button-delete
                                       data-id = item._id
                                       class = "btn btn-danger btn-sm ml-1"
                                    ) Xóa 
                                 a(
                                    href=`/admin/products/detail/${item._id}`
                                    class = "btn btn-secondary btn-sm"
                                    ) Chi tiết

      div(class = "text-center") 
         ul(class ="pagination")
            li(class = "page-item")
               if(pagination.currentPase > 1)
                  li(class = "page-item")
                     button(class = "page-link" 
                        button-page = pagination.currentPase -1  
                     ) Trang trước
               
            - for( let i = 1 ; i <= pagination.soLuongPage ;i++)
               li(class = `page-item ${pagination.currentPase === i ? "active" : "" }`)
                  button(class = "page-link"
                        button-page = i 
                        ) #{i}

            if(pagination.currentPase < pagination.soLuongPage)
                  li(class = "page-item")
                     button(class = "page-link" 
                        button-page = pagination.currentPase +1 
                     ) Trang sau
   //- status . 
   form(
      action=""
      method = "POST"
      id = "from-change-status"
      data-path = "/admin/products/change-status" 
   ) 

   form(
      action=""
      method = "POST"
      id = "from-change-item" 
      data-path = "/admin/products/delete"
   ) 